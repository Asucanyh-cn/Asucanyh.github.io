<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>ansible学习笔记Part3 | 小狼的学习笔记</title><meta name="keywords" content="ansible,linux"><meta name="author" content="Lptexas"><meta name="copyright" content="Lptexas"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="edb0f3"><meta name="description" content="ansible学习笔记">
<meta property="og:type" content="article">
<meta property="og:title" content="ansible学习笔记Part3">
<meta property="og:url" content="https://lptexas.top/posts/3436268892/index.html">
<meta property="og:site_name" content="小狼的学习笔记">
<meta property="og:description" content="ansible学习笔记">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://lptexas-cub.github.io/img/post/ansible.png">
<meta property="article:published_time" content="2023-01-23T16:00:00.000Z">
<meta property="article:modified_time" content="2024-10-04T08:17:54.457Z">
<meta property="article:author" content="Lptexas">
<meta property="article:tag" content="ansible">
<meta property="article:tag" content="linux">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://lptexas-cub.github.io/img/post/ansible.png"><link rel="shortcut icon" href="https://lptexas.top/img/web-info/logo.jpg"><link rel="canonical" href="https://lptexas.top/posts/3436268892/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  noticeOutdate: {"limitDay":365,"position":"top","messagePrev":"距离最近一次修改已经过去了","messageNext":"天了文章的内容可能已经过时，请注意辨别！"},
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#49b555","bgDark":"#1f1f1f","position":"bottom-left"},
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isAnchor: true
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'ansible学习笔记Part3',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2024-10-04 16:17:54'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><!--include ./third-party/aplayer.pug--><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', 'edb0f3')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><script src="/js/jquery.min.js"></script><link rel="stylesheet" href="/css/beautifly.css"><link rel="stylesheet" href="/css/iconfont/iconfont.css"><link rel="stylesheet" href="/css/function.min.css"></script><link rel="stylesheet" href="/css/hexoAdmonition.css"><script type="text/javascript" src="/js/banf12.js"></script><script>var _hmt = _hmt || [];(function(){var hm = document.createElement("script");hm.src="https://hm.baidu.com/hm.js?620b197f0a8f640c45f35a49041e7c3e";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script><meta name="baidu-site-verification" content="code-2fTRcAbDGe" /><meta name="generator" content="Hexo 6.3.0"><link rel="alternate" href="/atom.xml" title="小狼的学习笔记" type="application/atom+xml">
</head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">加载中...</div></div></div><div id="web_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://lptexas.top/img/web-info/avator.jpg" onerror="onerror=null;src='https://lptexas.top/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">115</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">92</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">18</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/links/"><i class="fa-fw fa fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page group hide" href="javascript:void(0);"><i class="fa-fw fa fa-heartbeat"></i><span> 分享</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> 音乐</span></a></li><li><a class="site-page child" href="/images/"><i class="fa-fw fas fa-images"></i><span> 图库</span></a></li><li><a class="site-page child" href="/collection/"><i class="fa-fw fa fa-globe"></i><span> 收藏</span></a></li></ul></div><div class="menus_item"><a class="site-page group hide" href="javascript:void(0);"><i class="fa-fw fa fa-laptop"></i><span> 监控</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/server-android/"><i class="fa-fw fa fa-server"></i><span> AndroidSrv-Monitor</span></a></li><li><a class="site-page child" href="/server-minecraft-manager/"><i class="fa-fw fa fa-th-large"></i><span> MinecraftSrv-Penal</span></a></li><li><a class="site-page child" href="/frps-dashboard/"><i class="fa-fw fa fa-tachometer"></i><span> frp-dashboard</span></a></li></ul></div><div class="menus_item"><a class="site-page group hide" href="javascript:void(0);"><i class="fa-fw fa fa-user-circle"></i><span> 关于</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/resume/"><i class="fa-fw fas fa-heart"></i><span> 简历</span></a></li><li><a class="site-page child" href="/schedule/"><i class="fa-fw fa fa-calendar"></i><span> 计划</span></a></li></ul></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://lptexas-cub.github.io/img/post/ansible.png')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">小狼的学习笔记</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/links/"><i class="fa-fw fa fa-link"></i><span> 友链</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page group hide" href="javascript:void(0);"><i class="fa-fw fa fa-heartbeat"></i><span> 分享</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/music/"><i class="fa-fw fas fa-music"></i><span> 音乐</span></a></li><li><a class="site-page child" href="/images/"><i class="fa-fw fas fa-images"></i><span> 图库</span></a></li><li><a class="site-page child" href="/collection/"><i class="fa-fw fa fa-globe"></i><span> 收藏</span></a></li></ul></div><div class="menus_item"><a class="site-page group hide" href="javascript:void(0);"><i class="fa-fw fa fa-laptop"></i><span> 监控</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/server-android/"><i class="fa-fw fa fa-server"></i><span> AndroidSrv-Monitor</span></a></li><li><a class="site-page child" href="/server-minecraft-manager/"><i class="fa-fw fa fa-th-large"></i><span> MinecraftSrv-Penal</span></a></li><li><a class="site-page child" href="/frps-dashboard/"><i class="fa-fw fa fa-tachometer"></i><span> frp-dashboard</span></a></li></ul></div><div class="menus_item"><a class="site-page group hide" href="javascript:void(0);"><i class="fa-fw fa fa-user-circle"></i><span> 关于</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/resume/"><i class="fa-fw fas fa-heart"></i><span> 简历</span></a></li><li><a class="site-page child" href="/schedule/"><i class="fa-fw fa fa-calendar"></i><span> 计划</span></a></li></ul></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">ansible学习笔记Part3<a class="post-edit-link" href="https://github.com/LPtexas-cub/BlogSourceCode/edit/main/source/_posts/Linux之Ansible自动化运维part3.md" title="编辑" target="_blank"><i class="fas fa-pencil-alt"></i></a></h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2023-01-23T16:00:00.000Z" title="发表于 2023-01-24 00:00:00">2023-01-24</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2024-10-04T08:17:54.457Z" title="更新于 2024-10-04 16:17:54">2024-10-04</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Linux/">Linux</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">3k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>17分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="ansible学习笔记Part3"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><blockquote>
<p><a href="https://lptexas.top/posts/3151396298/">接上一节</a></p>
</blockquote>
<h1 id="常用模块"><a href="#常用模块" class="headerlink" title="常用模块"></a>常用模块</h1><h2 id="hostname主机名"><a href="#hostname主机名" class="headerlink" title="hostname主机名"></a>hostname主机名</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">只有一个参数name，用于指定主机名</span></span><br></pre></td></tr></table></figure>

<h2 id="cron定时任务"><a href="#cron定时任务" class="headerlink" title="cron定时任务"></a>cron定时任务</h2><blockquote>
<p>支持：分时日月周（minute,hour,day,month,weekday）</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br></pre></td><td class="code"><pre><span class="line">OPTIONS (= is mandatory):</span><br><span class="line"></span><br><span class="line">- backup</span><br><span class="line">        If set, create a backup of the crontab before it is modified. The location of the backup is returned in the</span><br><span class="line">        `backup_file&#x27; variable by this module.</span><br><span class="line">        [Default: False]</span><br><span class="line">        type: bool</span><br><span class="line"></span><br><span class="line">- cron_file</span><br><span class="line">        If specified, uses this file instead of an individual user&#x27;s crontab.</span><br><span class="line">        If this is a relative path, it is interpreted with respect to `/etc/cron.d&#x27;.</span><br><span class="line">        If it is absolute, it will typically be `/etc/crontab&#x27;.</span><br><span class="line">        Many linux distros expect (and some require) the filename portion to consist solely of upper- and lower-case letters,</span><br><span class="line">        digits, underscores, and hyphens.</span><br><span class="line">        To use the `cron_file&#x27; parameter you must specify the `user&#x27; as well.</span><br><span class="line">        [Default: (null)]</span><br><span class="line">        type: str</span><br><span class="line"></span><br><span class="line">- day</span><br><span class="line">        Day of the month the job should run ( 1-31, *, */2, etc )</span><br><span class="line">        (Aliases: dom)[Default: *]</span><br><span class="line">        type: str</span><br><span class="line"></span><br><span class="line">- disabled</span><br><span class="line">        If the job should be disabled (commented out) in the crontab.</span><br><span class="line">        Only has effect if `state=present&#x27;.</span><br><span class="line">        [Default: False]</span><br><span class="line">        type: bool</span><br><span class="line">        version_added: 2.0</span><br><span class="line"></span><br><span class="line">- env</span><br><span class="line">        If set, manages a crontab&#x27;s environment variable.</span><br><span class="line">        New variables are added on top of crontab.</span><br><span class="line">        `name&#x27; and `value&#x27; parameters are the name and the value of environment variable.</span><br><span class="line">       [Default: False]</span><br><span class="line">        type: bool</span><br><span class="line">        version_added: 2.1</span><br><span class="line"></span><br><span class="line">- hour</span><br><span class="line">        Hour when the job should run ( 0-23, *, */2, etc )</span><br><span class="line">        [Default: *]</span><br><span class="line">        type: str</span><br><span class="line"></span><br><span class="line">- insertafter</span><br><span class="line">        Used with `state=present&#x27; and `env&#x27;.</span><br><span class="line">        If specified, the environment variable will be inserted after the declaration of specified environment variable.</span><br><span class="line">        [Default: (null)]</span><br><span class="line">        type: str</span><br><span class="line">        version_added: 2.1</span><br><span class="line"></span><br><span class="line">- insertbefore</span><br><span class="line">        Used with `state=present&#x27; and `env&#x27;.</span><br><span class="line">        If specified, the environment variable will be inserted before the declaration of specified environment variable.</span><br><span class="line">        [Default: (null)]</span><br><span class="line">        type: str</span><br><span class="line">        version_added: 2.1</span><br><span class="line"></span><br><span class="line">- job</span><br><span class="line">        The command to execute or, if env is set, the value of environment variable.</span><br><span class="line">        The command should not contain line breaks.</span><br><span class="line">        Required if `state=present&#x27;.</span><br><span class="line">        (Aliases: value)[Default: (null)]</span><br><span class="line">        type: str</span><br><span class="line"></span><br><span class="line">- minute</span><br><span class="line">        Minute when the job should run ( 0-59, *, */2, etc )</span><br><span class="line">        [Default: *]</span><br><span class="line">        type: str</span><br><span class="line"></span><br><span class="line">- month</span><br><span class="line">        Month of the year the job should run ( 1-12, *, */2, etc )</span><br><span class="line">        [Default: *]</span><br><span class="line">        type: str</span><br><span class="line"></span><br><span class="line">- name</span><br><span class="line">        Description of a crontab entry or, if env is set, the name of environment variable.</span><br><span class="line">        Required if `state=absent&#x27;.</span><br><span class="line">        Note that if name is not set and `state=present&#x27;, then a new crontab entry will always be created, regardless of</span><br><span class="line">        existing ones.</span><br><span class="line">        This parameter will always be required in future releases.</span><br><span class="line">        [Default: (null)]</span><br><span class="line">        type: str</span><br><span class="line"></span><br><span class="line">- reboot</span><br><span class="line">        If the job should be run at reboot. This option is deprecated. Users should use special_time.</span><br><span class="line">        [Default: False]</span><br><span class="line">        type: bool</span><br><span class="line">        version_added: 1.0</span><br><span class="line"></span><br><span class="line">- special_time</span><br><span class="line">        Special time specification nickname.</span><br><span class="line">        (Choices: annually, daily, hourly, monthly, reboot, weekly, yearly)[Default: (null)]</span><br><span class="line">        type: str</span><br><span class="line">        version_added: 1.3</span><br><span class="line"></span><br><span class="line">- state</span><br><span class="line">        Whether to ensure the job or environment variable is present or absent.</span><br><span class="line">        (Choices: absent, present)[Default: present]</span><br><span class="line">        type: str</span><br><span class="line"></span><br><span class="line">- user</span><br><span class="line">        The specific user whose crontab should be modified.</span><br><span class="line">        When unset, this parameter defaults to using `root&#x27;.</span><br><span class="line">        [Default: (null)]</span><br><span class="line">        type: str</span><br><span class="line"></span><br><span class="line">- weekday</span><br><span class="line">        Day of the week that the job should run ( 0-6 for Sunday-Saturday, *, etc )</span><br><span class="line">        (Aliases: dow)[Default: *]</span><br><span class="line">        type: str</span><br></pre></td></tr></table></figure>

<blockquote>
<p>创建一个定时任务</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ansible host -m cron -a &#x27;&#x27;minute=*/5 job=/path/to/job/&#x27;</span><br></pre></td></tr></table></figure>

<h2 id="yum包管理"><a href="#yum包管理" class="headerlink" title="yum包管理"></a>yum包管理</h2><blockquote>
<p>需要机器支持yum包管理器</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">常用参数</span></span><br><span class="line">- name </span><br><span class="line">- state</span><br><span class="line">        Whether to install (`present&#x27; or `installed&#x27;, `latest&#x27;), or remove (`absent&#x27; or `removed&#x27;) a package.</span><br><span class="line">        `present&#x27; and `installed&#x27; will simply ensure that a desired package is installed.</span><br><span class="line">        `latest&#x27; will update the specified package if it&#x27;s not of the latest available version.</span><br><span class="line">        `absent&#x27; and `removed&#x27; will remove the specified package.</span><br><span class="line">        Default is `None&#x27;, however in effect the default action is `present&#x27; unless the `autoremove&#x27; option is enabled for</span><br><span class="line">        this module, then `absent&#x27; is inferred.</span><br><span class="line">        (Choices: absent, installed, latest, present, removed)[Default: (null)]</span><br><span class="line">- list</span><br><span class="line">        Package name to run the equivalent of yum list --show-duplicates &lt;package&gt; against. In addition to listing packages,</span><br><span class="line">        use can also list the following: `installed&#x27;, `updates&#x27;, `available&#x27; and `repos&#x27;.</span><br><span class="line">        This parameter is mutually exclusive with `name&#x27;.</span><br><span class="line">        [Default: (null)]</span><br><span class="line">-...</span><br></pre></td></tr></table></figure>

<h2 id="service服务管理"><a href="#service服务管理" class="headerlink" title="service服务管理"></a>service服务管理</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">常用参数</span></span><br><span class="line">- name: # 介绍功能</span><br><span class="line">  service:</span><br><span class="line">    name: # 服务名</span><br><span class="line">    state: # 状态，可选参数started、restarted、reloaded、stopped</span><br><span class="line">    enable: # bool型，是否开启开机自启</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash"><span class="comment"># commandline</span></span></span><br><span class="line">ansible host -m service -a &#x27;name=&lt;...&gt; state=&lt;...&gt; enable=&lt;true|false&gt;&#x27;</span><br></pre></td></tr></table></figure>

<h2 id="user管理用户"><a href="#user管理用户" class="headerlink" title="user管理用户"></a>user管理用户</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">- name: Manage user accounts</span><br><span class="line">  user:</span><br><span class="line">      append:                # If `yes&#x27;, add the user to the groups specified in `groups&#x27;. If `no&#x27;, user will only be added to the groups specified in `groups&#x27;, removing them from all other groups. Mutually exclusive with `local&#x27;</span><br><span class="line">      authorization:         # Sets the authorization of the user. Does nothing when used with other platforms. Can set multiple authorizations using comma separation. To delete all authorizations, use `authorization=&#x27;&#x27;&#x27;. Currently supported on Illumos/Solaris.</span><br><span class="line">      comment:               # 描述信息# Optionally sets the description (aka `GECOS&#x27;) of user account.</span><br><span class="line">      create_home:           # Unless set to `no&#x27;, a home directory will be made for the user when the account is created or if the home directory does not</span><br><span class="line">                               exist. Changed from `createhome&#x27; to `create_home&#x27; in Ansible 2.5.</span><br><span class="line">      expires:              # 设置账号有效期 # An expiry time for the user in epoch, it will be ignored on platforms that do not support this. Currently supported on GNU/Linux, FreeBSD, and DragonFlyBSD. Since Ansible 2.6 you can remove the expiry time specify a negative value. Currently supported on GNU/Linux and FreeBSD.</span><br><span class="line">      force:                 # This only affects `state=absent&#x27;, it forces removal of the user and associated directories on supported platforms. The behavior is the same as `userdel --force&#x27;, check the man page for `userdel&#x27; on your system for details and support. When used with `generate_ssh_key=yes&#x27; this forces an existing key to be overwritten.</span><br><span class="line">      generate_ssh_key:      # Whether to generate a SSH key for the user in question. This will *not* overwrite an existing SSH key unless used with  `force=yes&#x27;.</span><br><span class="line">      group:                 # 设置主组 # Optionally sets the user&#x27;s primary group (takes a group name).</span><br><span class="line">      groups:                # 设置附加组 # List of groups user will be added to. When set to an empty string `&#x27;&#x27;&#x27;, the user is removed from all groups except the primary group. Before Ansible 2.3, the only input format allowed was a comma separated string. Mutually exclusive with `local&#x27;</span><br><span class="line">      hidden:                # macOS only, optionally hide the user from the login window and system preferences. The default will be `yes&#x27; if the `system&#x27; option is used.</span><br><span class="line">      home:                # 指定用户家目录  # Optionally set the user&#x27;s home directory.</span><br><span class="line">      local:                 # Forces the use of &quot;local&quot; command alternatives on platforms that implement it. This is useful in environments that use centralized authentification when you want to manipulate the local users (i.e. it uses `luseradd&#x27; instead of `useradd&#x27;). This will check `/etc/passwd&#x27; for an existing account before invoking commands. If the local account database exists somewhere other than `/etc/passwd&#x27;, this setting will not work properly. This requires that the above commands as well as `/etc/passwd&#x27; must exist on the target host, otherwise it will be a fatal error. Mutually exclusive with `groups&#x27; and `append&#x27;</span><br><span class="line">      login_class:           # Optionally sets the user&#x27;s login class, a feature of most BSD OSs.</span><br><span class="line">      move_home:             # If set to `yes&#x27; when used with `home: &#x27;, attempt to move the user&#x27;s old home directory to the specified directory if it isn&#x27;t there already and the old home exists.</span><br><span class="line">      name:                 # 设置用户名 # (required) Name of the user to create, remove or modify.</span><br><span class="line">      non_unique:            # Optionally when used with the -u option, this option allows to change the user ID to a non-unique value.</span><br><span class="line">      password:              # 设置用户的密码 # Optionally set the user&#x27;s password to this crypted value. On macOS systems, this value has to be cleartext. Beware of security issues. To create a disabled account on Linux systems, set this to `&#x27;!&#x27;&#x27; or `&#x27;*&#x27;&#x27;. To create a disabled account on OpenBSD, set this to `&#x27;*************&#x27;&#x27;. See https://docs.ansible.com/ansible/faq.html#how-do-i-generate-encrypted-passwords-for-the-user-module for details on various ways to generate these password values. </span><br><span class="line">      password_lock:         # Lock the password (`usermod -L&#x27;, `usermod -U&#x27;, `pw lock&#x27;). Implementation differs by platform. This option does not always mean the user cannot login using other methods. This option does not disable the user, only lock the password. This must be set to `False&#x27; in order to unlock a currently locked password. The absence of this parameter will not unlock a password. Currently supported on Linux, FreeBSD, DragonFlyBSD, NetBSD, OpenBSD.</span><br><span class="line">      profile:               # Sets the profile of the user. Does nothing when used with other platforms. Can set multiple profiles using comma separation.  To delete all the profiles, use `profile=&#x27;&#x27;&#x27;. Currently supported on Illumos/Solaris.</span><br><span class="line">      remove:               #是否在删除用户的同时删除家目录 # This only affects `state=absent&#x27;, it attempts to remove directories associated with the user. The behavior is the same as   `userdel --remove&#x27;, check the man page for details and support.</span><br><span class="line">      role:                  # Sets the role of the user. Does nothing when used with other platforms. Can set multiple roles using comma separation. To delete all roles, use `role=&#x27;&#x27;&#x27;. Currently supported on Illumos/Solaris.</span><br><span class="line">      seuser:                # Optionally sets the seuser type (user_u) on selinux enabled systems.</span><br><span class="line">      shell:                 # Optionally set the user&#x27;s shell. On macOS, before Ansible 2.5, the default shell for non-system users was `/usr/bin/false&#x27;.  Since Ansible 2.5, the default shell for non-system users on macOS is `/bin/bash&#x27;. On other operating systems, the default shell is determined by the underlying tool being used. See Notes   for details.</span><br><span class="line">      skeleton:              # Optionally set a home skeleton directory. Requires `create_home&#x27; option!</span><br><span class="line">      ssh_key_bits:          # Optionally specify number of bits in SSH key to create.</span><br><span class="line">      ssh_key_comment:       # Optionally define the comment for the SSH key.</span><br><span class="line">      ssh_key_file:          # Optionally specify the SSH key filename. If this is a relative filename then it will be relative to the user&#x27;s home directory. This parameter defaults to `.ssh/id_rsa&#x27;.</span><br><span class="line">      ssh_key_passphrase:    # Set a passphrase for the SSH key. If no passphrase is provided, the SSH key will default to having no passphrase.</span><br><span class="line">      ssh_key_type:          # Optionally specify the type of SSH key to generate. Available SSH key types will depend on implementation present on target   host.</span><br><span class="line">      state:               # 对用户进行的操作（删除absent，默认present创建） # Whether the account should exist or not, taking action if the state is different from what is stated.</span><br><span class="line">      system:               # 是否设置用户为系统用户 # When creating an account `state=present&#x27;, setting this to `yes&#x27; makes the user a system account. This setting cannot be</span><br><span class="line">                               changed on existing users.</span><br><span class="line">      uid:                   # 手动设置用户的uid # Optionally sets the `UID&#x27; of the user.</span><br><span class="line">      update_password:      # 更行用户密码 # `always&#x27; will update passwords if they differ. `on_create&#x27; will only set the password for newly created users.</span><br></pre></td></tr></table></figure>

<h2 id="group管理组"><a href="#group管理组" class="headerlink" title="group管理组"></a>group管理组</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">- name: Add or remove groups</span><br><span class="line">  group:</span><br><span class="line">      gid:                   # Optional `GID&#x27; to set for the group.</span><br><span class="line">      local:                 # Forces the use of &quot;local&quot; command alternatives on platforms that implement it. This is useful in environments that use centralized authentication when you want to manipulate the local groups. (e.g. it uses `lgroupadd&#x27; instead of `groupadd&#x27;). This requires that these commands exist on the targeted host, otherwise it will be a fatal error.</span><br><span class="line">      name:                  # (required) Name of the group to manage.</span><br><span class="line">      non_unique:            # This option allows to change the group ID to a non-unique value. Requires `gid&#x27;. Not supported on macOS or BusyBox distributions.</span><br><span class="line">      state:                 # Whether the group should be present or not on the remote host.</span><br><span class="line">      system:                # If `yes&#x27;, indicates that the group created is a system group.</span><br></pre></td></tr></table></figure>



<h1 id="ansible-galaxy命令"><a href="#ansible-galaxy命令" class="headerlink" title="ansible-galaxy命令"></a>ansible-galaxy命令</h1><blockquote>
<p>连接<a target="_blank" rel="noopener" href="https://galaxy.ansible.com下载相应的roles./">https://galaxy.ansible.com下载相应的roles。</a></p>
</blockquote>
<h2 id="列出roles"><a href="#列出roles" class="headerlink" title="列出roles"></a>列出roles</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ansible-galaxy list</span><br></pre></td></tr></table></figure>

<h2 id="下载roles"><a href="#下载roles" class="headerlink" title="下载roles"></a>下载roles</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ansible-galaxy install &lt;&gt;</span><br></pre></td></tr></table></figure>

<h2 id="删除roles"><a href="#删除roles" class="headerlink" title="删除roles"></a>删除roles</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ansible-galaxy remove &lt;&gt;</span><br></pre></td></tr></table></figure>

<h1 id="ansible-playbook命令"><a href="#ansible-playbook命令" class="headerlink" title="ansible-playbook命令"></a>ansible-playbook命令</h1><blockquote>
<p>剧本</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line">optional arguments:</span><br><span class="line">  --ask-vault-pass      ask for vault password</span><br><span class="line">  --flush-cache         clear the fact cache for every host in inventory</span><br><span class="line">  --force-handlers      run handlers even if a task fails</span><br><span class="line"><span class="meta prompt_">  # </span><span class="language-bash">列出主机</span></span><br><span class="line">  --list-hosts          outputs a list of matching hosts; does not execute</span><br><span class="line">                        anything else</span><br><span class="line"><span class="meta prompt_"> # </span><span class="language-bash">列出所有标签</span></span><br><span class="line">  --list-tags           list all available tags</span><br><span class="line"><span class="meta prompt_">  # </span><span class="language-bash">列出所有任务</span></span><br><span class="line">  --list-tasks          list all tasks that would be executed</span><br><span class="line">  --skip-tags SKIP_TAGS</span><br><span class="line">                        only run plays and tasks whose tags do not match these</span><br><span class="line">                        values</span><br><span class="line">  --start-at-task START_AT_TASK</span><br><span class="line">                        start the playbook at the task matching this name</span><br><span class="line">  --step                one-step-at-a-time: confirm each task before running</span><br><span class="line">  --syntax-check        perform a syntax check on the playbook, but do not</span><br><span class="line">                        execute it</span><br><span class="line">  --vault-id VAULT_IDS  the vault identity to use</span><br><span class="line">  --vault-password-file VAULT_PASSWORD_FILES</span><br><span class="line">                        vault password file</span><br><span class="line">  --version             show program&#x27;s version number, config file location,</span><br><span class="line">                        configured module search path, module location,</span><br><span class="line">                        executable location and exit</span><br><span class="line"><span class="meta prompt_">  # </span><span class="language-bash">运行测试，并不会做修改</span></span><br><span class="line">  -C, --check           don&#x27;t make any changes; instead, try to predict some</span><br><span class="line">                        of the changes that may occur</span><br><span class="line">  -D, --diff            when changing (small) files and templates, show the</span><br><span class="line">                        differences in those files; works great with --check</span><br><span class="line">  -M MODULE_PATH, --module-path MODULE_PATH</span><br><span class="line">                        prepend colon-separated path(s) to module library (def</span><br><span class="line">                        ault=~/.ansible/plugins/modules:/usr/share/ansible/plu</span><br><span class="line">                        gins/modules)</span><br><span class="line">  -e EXTRA_VARS, --extra-vars EXTRA_VARS</span><br><span class="line">                        set additional variables as key=value or YAML/JSON, if</span><br><span class="line">                        filename prepend with @</span><br><span class="line"><span class="meta prompt_">  # </span><span class="language-bash">修改并发数目，默认为5</span></span><br><span class="line">  -f FORKS, --forks FORKS</span><br><span class="line">                        specify number of parallel processes to use</span><br><span class="line">                        (default=5)</span><br><span class="line">  -h, --help            show this help message and exit</span><br><span class="line">  -i INVENTORY, --inventory INVENTORY, --inventory-file INVENTORY</span><br><span class="line">                        specify inventory host path or comma separated host</span><br><span class="line">                        list. --inventory-file is deprecated</span><br><span class="line">  -l SUBSET, --limit SUBSET</span><br><span class="line">                        further limit selected hosts to an additional pattern</span><br><span class="line">  -t TAGS, --tags TAGS  only run plays and tasks tagged with these values</span><br><span class="line">  -v, --verbose         verbose mode (-vvv for more, -vvvv to enable</span><br><span class="line">                        connection debugging)</span><br><span class="line">Privilege Escalation Options:</span><br><span class="line">  control how and which user you become as on target hosts</span><br><span class="line"></span><br><span class="line">  --become-method BECOME_METHOD</span><br><span class="line">                        privilege escalation method to use (default=sudo), use</span><br><span class="line">                        `ansible-doc -t become -l` to list valid choices.</span><br><span class="line">  --become-user BECOME_USER</span><br><span class="line">                        run operations as this user (default=root)</span><br><span class="line">  -K, --ask-become-pass</span><br><span class="line">                        ask for privilege escalation password</span><br><span class="line">  -b, --become          run operations with become (does not imply password</span><br><span class="line">                        prompting)</span><br></pre></td></tr></table></figure>

<h1 id="ansible-vault命令"><a href="#ansible-vault命令" class="headerlink" title="ansible-vault命令"></a>ansible-vault命令</h1><blockquote>
<p>对yml剧本文件进行加密解密</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">positional arguments:</span><br><span class="line">  &#123;create,decrypt,edit,view,encrypt,encrypt_string,rekey&#125;</span><br><span class="line">    create              Create new vault encrypted file</span><br><span class="line">    decrypt             Decrypt vault encrypted file</span><br><span class="line">    edit                Edit vault encrypted file</span><br><span class="line">    view                View vault encrypted file</span><br><span class="line">    encrypt             Encrypt YAML file</span><br><span class="line">    encrypt_string      Encrypt a string</span><br><span class="line">    rekey               Re-key a vault encrypted file</span><br><span class="line"></span><br><span class="line">optional arguments:</span><br><span class="line">  --version             show program&#x27;s version number, config file location,</span><br><span class="line">                        configured module search path, module location,</span><br><span class="line">                        executable location and exit</span><br><span class="line">  -h, --help            show this help message and exit</span><br><span class="line">  -v, --verbose         verbose mode (-vvv for more, -vvvv to enable</span><br><span class="line">                        connection debugging)</span><br></pre></td></tr></table></figure>

<h2 id="加密-x2F-解密"><a href="#加密-x2F-解密" class="headerlink" title="加密&#x2F;解密"></a>加密&#x2F;解密</h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ansible-vault encrypt/decrypt &lt;&gt;</span><br></pre></td></tr></table></figure>

<h1 id="剧本yaml文件语法"><a href="#剧本yaml文件语法" class="headerlink" title="剧本yaml文件语法"></a>剧本yaml文件语法</h1><h2 id="结合ansible做简单介绍"><a href="#结合ansible做简单介绍" class="headerlink" title="结合ansible做简单介绍"></a>结合ansible做简单介绍</h2><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">---</span> <span class="comment">#开头三个连接符表示档案的开始，可以不写，这只是一个习惯</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">hosts:</span> <span class="comment">#指定主机，类似ansible后的第一个参数</span></span><br><span class="line">  <span class="attr">remote_user:</span> <span class="comment">#指定登录的用户</span></span><br><span class="line">  </span><br><span class="line">  <span class="attr">tasks:</span> </span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="comment">#任务模块，描述信息，一个name对应一个模块</span></span><br><span class="line">      <span class="string">&lt;module&gt;:</span> <span class="comment">#模块名和参数的键值对（这是最常用的形式）</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> </span><br><span class="line">      <span class="attr">action:</span> <span class="string">&lt;module&gt;</span> <span class="string">&lt;argues&gt;</span> <span class="comment">#这是第二种形式（不常用）</span></span><br><span class="line"><span class="string">...</span> <span class="comment">#表示结尾，可以不写</span></span><br></pre></td></tr></table></figure>

<h2 id="tasks-handlers和tags"><a href="#tasks-handlers和tags" class="headerlink" title="tasks,handlers和tags"></a>tasks,handlers和tags</h2><blockquote>
<p>tasks中的任务是依次执行的，当出现前一个任务修改了配置文件，后一个任务是启动服务的情况时，tasks无法让服务重启使新的配置生效。</p>
</blockquote>
<div class="admonition note"><p class="admonition-title">handlers
</p><p>handlers触发器，可以用来解决上述问题。</p>
</div>

<h2 id="handlers"><a href="#handlers" class="headerlink" title="handlers"></a>handlers</h2><blockquote>
<p>与tasks平级，需要使用<code>notify</code>绑定事件</p>
</blockquote>
<p>以nginx服务为例</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">hosts:</span> <span class="string">centos</span></span><br><span class="line">  <span class="attr">remote_user:</span> <span class="string">root</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">tasks:</span></span><br><span class="line"><span class="comment">#    - name: install nginx</span></span><br><span class="line"><span class="comment">#      yum: name=nginx</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">config</span></span><br><span class="line">      <span class="attr">copy:</span> <span class="string">src=/etc/nginx/nginx.conf</span> <span class="string">dest=/etc/nginx/</span></span><br><span class="line">      <span class="attr">notify:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">restart</span> <span class="string">nginx</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">check</span> <span class="string">nginx</span> <span class="string">process</span></span><br><span class="line">      <span class="attr">tags:</span> <span class="string">copy_config</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">start</span> <span class="string">nginx</span> <span class="string">service</span></span><br><span class="line">      <span class="attr">service:</span> <span class="string">name=nginx</span> <span class="string">state=started</span> <span class="string">enabled=yes</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">handlers:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">restart</span> <span class="string">nginx</span></span><br><span class="line">      <span class="attr">service:</span> <span class="string">name=nginx</span> <span class="string">state=restarted</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">check</span> <span class="string">nginx</span> <span class="string">process</span></span><br><span class="line">      <span class="attr">shell:</span> <span class="string">killall</span> <span class="number">-0</span> <span class="string">nginx</span> <span class="string">&gt;</span> <span class="string">/tmp/nginx.log</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="tags"><a href="#tags" class="headerlink" title="tags"></a>tags</h2><blockquote>
<p>使用标签，可以用于特定执行某些动作。</p>
</blockquote>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ...</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">config</span></span><br><span class="line">      <span class="attr">copy:</span> <span class="string">src=/etc/nginx/nginx.conf</span> <span class="string">dest=/etc/nginx/</span></span><br><span class="line">      <span class="attr">notify:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">restart</span> <span class="string">nginx</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">check</span> <span class="string">nginx</span> <span class="string">process</span></span><br><span class="line">      <span class="attr">tags:</span> <span class="string">copy_config</span></span><br><span class="line"><span class="comment"># ...</span></span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">使用-t参数可以指定标签</span></span><br><span class="line">ansible-playbook nginx.yml -t copy_config</span><br></pre></td></tr></table></figure>



</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="https://lptexas.top">Lptexas</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://lptexas.top/posts/3436268892/">https://lptexas.top/posts/3436268892/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://lptexas.top" target="_blank">小狼的学习笔记</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/ansible/">ansible</a><a class="post-meta__tags" href="/tags/linux/">linux</a></div><div class="post_share"><div class="social-share" data-image="https://lptexas-cub.github.io/img/post/ansible.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button"><i class="fas fa-qrcode"></i> 打赏</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="https://lptexas.top/img/wechat.jpg" target="_blank"><img class="post-qr-code-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://lptexas.top/img/wechat.jpg" alt="Wechat"/></a><div class="post-qr-code-desc">Wechat</div></li><li class="reward-item"><a href="https://lptexas.top/img/alipay.jpg" target="_blank"><img class="post-qr-code-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://lptexas.top/img/alipay.jpg" alt="Alipay"/></a><div class="post-qr-code-desc">Alipay</div></li></ul></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/posts/3151396298/"><img class="prev-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://lptexas-cub.github.io/img/post/ansible.png" onerror="onerror=null;src='https://lptexas.top/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">ansible学习笔记Part2</div></div></a></div><div class="next-post pull-right"><a href="/posts/880228874/"><img class="next-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://lptexas.top/img/post/curl.png" onerror="onerror=null;src='https://lptexas.top/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">解决curl命令报错</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/posts/585051248/" title="ansible学习笔记Part1"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://lptexas-cub.github.io/img/post/ansible.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-01-20</div><div class="title">ansible学习笔记Part1</div></div></a></div><div><a href="/posts/3151396298/" title="ansible学习笔记Part2"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://lptexas-cub.github.io/img/post/ansible.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-01-22</div><div class="title">ansible学习笔记Part2</div></div></a></div><div><a href="/posts/1387649279/" title="ansible学习笔记Part4"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://asucanyh-cn.github.io/img/post/ansible.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-01-30</div><div class="title">ansible学习笔记Part4</div></div></a></div><div><a href="/posts/632481897/" title="ansible学习笔记Part5"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://asucanyh-cn.github.io/img/post/ansible.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-02-02</div><div class="title">ansible学习笔记Part5</div></div></a></div><div><a href="/posts/2213938717/" title="ansible报错解决方案"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://lptexas.top/img/post/ansible.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-01-20</div><div class="title">ansible报错解决方案</div></div></a></div></div></div><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div id="twikoo-wrap"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://lptexas.top/img/web-info/avator.jpg" onerror="this.onerror=null;this.src='https://lptexas.top/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">Lptexas</div><div class="author-info__description">前端|后端|运维</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">115</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">92</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">18</div></a></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/LPtexas-cub"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://qm.qq.com/cgi-bin/qm/qr?k=KdVlnsIni7_hzcBCaK58Eydx9x3gt2CF&amp;noverify=0" target="_blank" title="QQ"><i class="fab fa-qq"></i></a><a class="social-icon" href="https://www.zhihu.com/people/ashbell" target="_blank" title="知乎"><i class="iconfont icon-zhihu-circle-fill"></i></a><a class="social-icon" href="mailto:Asucanyh@outlook.com" target="_blank" title="Email"><i class="fa fa-envelope"></i></a></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="fas fa-bullhorn fa-shake"></i><span>公告</span></div><div class="announcement_content">A<br><a target="_blank" rel="noopener" href="https://LPtexas-cub.github.io/">Github Version</a></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content is-expand"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%B8%B8%E7%94%A8%E6%A8%A1%E5%9D%97"><span class="toc-number">1.</span> <span class="toc-text">常用模块</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#hostname%E4%B8%BB%E6%9C%BA%E5%90%8D"><span class="toc-number">1.1.</span> <span class="toc-text">hostname主机名</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#cron%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1"><span class="toc-number">1.2.</span> <span class="toc-text">cron定时任务</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#yum%E5%8C%85%E7%AE%A1%E7%90%86"><span class="toc-number">1.3.</span> <span class="toc-text">yum包管理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#service%E6%9C%8D%E5%8A%A1%E7%AE%A1%E7%90%86"><span class="toc-number">1.4.</span> <span class="toc-text">service服务管理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#user%E7%AE%A1%E7%90%86%E7%94%A8%E6%88%B7"><span class="toc-number">1.5.</span> <span class="toc-text">user管理用户</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#group%E7%AE%A1%E7%90%86%E7%BB%84"><span class="toc-number">1.6.</span> <span class="toc-text">group管理组</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#ansible-galaxy%E5%91%BD%E4%BB%A4"><span class="toc-number">2.</span> <span class="toc-text">ansible-galaxy命令</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%97%E5%87%BAroles"><span class="toc-number">2.1.</span> <span class="toc-text">列出roles</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%8B%E8%BD%BDroles"><span class="toc-number">2.2.</span> <span class="toc-text">下载roles</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%A0%E9%99%A4roles"><span class="toc-number">2.3.</span> <span class="toc-text">删除roles</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#ansible-playbook%E5%91%BD%E4%BB%A4"><span class="toc-number">3.</span> <span class="toc-text">ansible-playbook命令</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#ansible-vault%E5%91%BD%E4%BB%A4"><span class="toc-number">4.</span> <span class="toc-text">ansible-vault命令</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8A%A0%E5%AF%86-x2F-%E8%A7%A3%E5%AF%86"><span class="toc-number">4.1.</span> <span class="toc-text">加密&#x2F;解密</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%89%A7%E6%9C%ACyaml%E6%96%87%E4%BB%B6%E8%AF%AD%E6%B3%95"><span class="toc-number">5.</span> <span class="toc-text">剧本yaml文件语法</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BB%93%E5%90%88ansible%E5%81%9A%E7%AE%80%E5%8D%95%E4%BB%8B%E7%BB%8D"><span class="toc-number">5.1.</span> <span class="toc-text">结合ansible做简单介绍</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#tasks-handlers%E5%92%8Ctags"><span class="toc-number">5.2.</span> <span class="toc-text">tasks,handlers和tags</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#handlers"><span class="toc-number">5.3.</span> <span class="toc-text">handlers</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#tags"><span class="toc-number">5.4.</span> <span class="toc-text">tags</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/posts/1975607171/" title="Vue2学习笔记Part3"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://asucanyh-cn.github.io/img/post/vue.png" onerror="this.onerror=null;this.src='https://lptexas.top/img/404.jpg'" alt="Vue2学习笔记Part3"/></a><div class="content"><a class="title" href="/posts/1975607171/" title="Vue2学习笔记Part3">Vue2学习笔记Part3</a><time datetime="2023-08-06T16:00:00.000Z" title="发表于 2023-08-07 00:00:00">2023-08-07</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/2031351995/" title="在手机上使用MAA一键长草"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://lptexas-cub.github.io/img/post/arknights.png" onerror="this.onerror=null;this.src='https://lptexas.top/img/404.jpg'" alt="在手机上使用MAA一键长草"/></a><div class="content"><a class="title" href="/posts/2031351995/" title="在手机上使用MAA一键长草">在手机上使用MAA一键长草</a><time datetime="2023-08-06T16:00:00.000Z" title="发表于 2023-08-07 00:00:00">2023-08-07</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/46558997/" title="Vue2学习笔记Part2"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://asucanyh-cn.github.io/img/post/vue.png" onerror="this.onerror=null;this.src='https://lptexas.top/img/404.jpg'" alt="Vue2学习笔记Part2"/></a><div class="content"><a class="title" href="/posts/46558997/" title="Vue2学习笔记Part2">Vue2学习笔记Part2</a><time datetime="2023-08-05T16:00:00.000Z" title="发表于 2023-08-06 00:00:00">2023-08-06</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/2315174609/" title="Nodejs学习笔记Part2"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://asucanyh-cn.github.io/img/post/nodejs.png" onerror="this.onerror=null;this.src='https://lptexas.top/img/404.jpg'" alt="Nodejs学习笔记Part2"/></a><div class="content"><a class="title" href="/posts/2315174609/" title="Nodejs学习笔记Part2">Nodejs学习笔记Part2</a><time datetime="2023-07-14T16:00:00.000Z" title="发表于 2023-07-15 00:00:00">2023-07-15</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/posts/2614050479/" title="Vue2学习笔记Part1"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://asucanyh-cn.github.io/img/post/vue.png" onerror="this.onerror=null;this.src='https://lptexas.top/img/404.jpg'" alt="Vue2学习笔记Part1"/></a><div class="content"><a class="title" href="/posts/2614050479/" title="Vue2学习笔记Part1">Vue2学习笔记Part1</a><time datetime="2023-07-13T16:00:00.000Z" title="发表于 2023-07-14 00:00:00">2023-07-14</time></div></div></div></div></div></div></main><footer id="footer" style="background-image: url('https://lptexas-cub.github.io/img/post/ansible.png')"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2024 By Lptexas</div><div class="framework-info"><!-- span= _p('footer.framework') + ' '--><!-- a(href='https://hexo.io')= 'Hexo'--><!-- span.footer-separator |--><!-- span= _p('footer.theme') + ' '--><!-- a(href='https://github.com/jerryc127/hexo-theme-butterfly')= 'Butterfly'--><span>邮箱 </span><span class="footer-separator">|</span><a href="mailto:asucanyh@outlook.com">@Asucanyh</a></div><div class="framework-info"><!--img(src = '')--><!--span= ' '--><!--a(href='https://beian.miit.gov.cn/')= '待获取'--><img style="width:24px;height:24px;margin-bottom:-4px" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://lptexas-cub.github.io/img/web-info/gongan.png"/><a href="https://beian.miit.gov.cn" target="_blank" data-pjax-state="">
<span style="color:#ff0000">蜀</span>
<span style="color:#ca7900">I</span>
<span style="color:#48ab18">C</span>
<span style="color:#2720ac">P</span>
<span style="color:#9b17ae">备</span> 
</a>
<a href="https://beian.miit.gov.cn" target="_blank" data-pjax-state="external"> 
<span style="color:#ff0000">20</span>
<span style="color:#ca7900">22</span>
<span style="color:#48ab18">01</span>
<span style="color:#2720ac">84</span>
<span style="color:#2778ac">59</span>
<span style="color:#f40428">号</span>
<span style="color:ff00880">-1</span>
</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="fas fa-comments"></i></a><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div></div></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload/dist/lazyload.iife.min.js"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><script>function panguFn () {
  if (typeof pangu === 'object') pangu.autoSpacingPage()
  else {
    getScript('https://cdn.jsdelivr.net/npm/pangu/dist/browser/pangu.min.js')
      .then(() => {
        pangu.autoSpacingPage()
      })
  }
}

function panguInit () {
  if (false){
    GLOBAL_CONFIG_SITE.isPost && panguFn()
  } else {
    panguFn()
  }
}

document.addEventListener('DOMContentLoaded', panguInit)</script><script src="/js/search/local-search.js"></script><script>var preloader = {
  endLoading: () => {
    document.body.style.overflow = 'auto';
    document.getElementById('loading-box').classList.add("loaded")
  },
  initLoading: () => {
    document.body.style.overflow = '';
    document.getElementById('loading-box').classList.remove("loaded")

  }
}
window.addEventListener('load',preloader.endLoading())</script><div class="js-pjax"><script>(() => {
  const $mermaidWrap = document.querySelectorAll('#article-container .mermaid-wrap')
  if ($mermaidWrap.length) {
    window.runMermaid = () => {
      window.loadMermaid = true
      const theme = document.documentElement.getAttribute('data-theme') === 'dark' ? 'dark' : 'default'

      Array.from($mermaidWrap).forEach((item, index) => {
        const mermaidSrc = item.firstElementChild
        const mermaidThemeConfig = '%%{init:{ \'theme\':\'' + theme + '\'}}%%\n'
        const mermaidID = 'mermaid-' + index
        const mermaidDefinition = mermaidThemeConfig + mermaidSrc.textContent
        mermaid.mermaidAPI.render(mermaidID, mermaidDefinition, (svgCode) => {
          mermaidSrc.insertAdjacentHTML('afterend', svgCode)
        })
      })
    }

    const loadMermaid = () => {
      window.loadMermaid ? runMermaid() : getScript('https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js').then(runMermaid)
    }

    window.pjax ? loadMermaid() : document.addEventListener('DOMContentLoaded', loadMermaid)
  }
})()</script><script>(()=>{
  const init = () => {
    twikoo.init(Object.assign({
      el: '#twikoo-wrap',
      envId: 'https://vercel.lptexas.top',
      region: '',
      onCommentLoaded: function () {
        btf.loadLightbox(document.querySelectorAll('#twikoo .tk-content img:not(.tk-owo-emotion)'))
      }
    }, null))
  }

  const getCount = () => {
    const countELement = document.getElementById('twikoo-count')
    if(!countELement) return
    twikoo.getCommentsCount({
      envId: 'https://vercel.lptexas.top',
      region: '',
      urls: [window.location.pathname],
      includeReply: false
    }).then(function (res) {
      countELement.innerText = res[0].count
    }).catch(function (err) {
      console.error(err);
    });
  }

  const runFn = () => {
    init()
    GLOBAL_CONFIG_SITE.isPost && getCount()
  }

  const loadTwikoo = () => {
    if (typeof twikoo === 'object') {
      setTimeout(runFn,0)
      return
    } 
    getScript('https://cdn.jsdelivr.net/npm/twikoo/dist/twikoo.all.min.js').then(runFn)
  }

  if ('Twikoo' === 'Twikoo' || !true) {
    if (true) btf.loadComment(document.getElementById('twikoo-wrap'), loadTwikoo)
    else loadTwikoo()
  } else {
    window.loadOtherComment = () => {
      loadTwikoo()
    }
  }
})()</script></div><script>window.addEventListener('load', () => {
  const changeContent = (content) => {
    if (content === '') return content

    content = content.replace(/<img.*?src="(.*?)"?[^\>]+>/ig, '[图片]') // replace image link
    content = content.replace(/<a[^>]+?href=["']?([^"']+)["']?[^>]*>([^<]+)<\/a>/gi, '[链接]') // replace url
    content = content.replace(/<pre><code>.*?<\/pre>/gi, '[代码]') // replace code
    content = content.replace(/<[^>]+>/g,"") // remove html tag

    if (content.length > 150) {
      content = content.substring(0,150) + '...'
    }
    return content
  }

  const getComment = () => {
    const runTwikoo = () => {
      twikoo.getRecentComments({
        envId: 'https://vercel.lptexas.top',
        region: '',
        pageSize: 6,
        includeReply: true
      }).then(function (res) {
        const twikooArray = res.map(e => {
          return {
            'content': changeContent(e.comment),
            'avatar': e.avatar,
            'nick': e.nick,
            'url': e.url + '#' + e.id,
            'date': new Date(e.created).toISOString()
          }
        })

        saveToLocal.set('twikoo-newest-comments', JSON.stringify(twikooArray), 10/(60*24))
        generateHtml(twikooArray)
      }).catch(function (err) {
        const $dom = document.querySelector('#card-newest-comments .aside-list')
        $dom.innerHTML= "无法获取评论，请确认相关配置是否正确"
      })
    }

    if (typeof twikoo === 'object') {
      runTwikoo()
    } else {
      getScript('https://cdn.jsdelivr.net/npm/twikoo/dist/twikoo.all.min.js').then(runTwikoo)
    }
  }

  const generateHtml = array => {
    let result = ''

    if (array.length) {
      for (let i = 0; i < array.length; i++) {
        result += '<div class=\'aside-list-item\'>'

        if (true) {
          const name = 'data-lazy-src'
          result += `<a href='${array[i].url}' class='thumbnail'><img ${name}='${array[i].avatar}' alt='${array[i].nick}'></a>`
        }
        
        result += `<div class='content'>
        <a class='comment' href='${array[i].url}' title='${array[i].content}'>${array[i].content}</a>
        <div class='name'><span>${array[i].nick} / </span><time datetime="${array[i].date}">${btf.diffDate(array[i].date, true)}</time></div>
        </div></div>`
      }
    } else {
      result += '没有评论'
    }

    let $dom = document.querySelector('#card-newest-comments .aside-list')
    $dom.innerHTML= result
    window.lazyLoadInstance && window.lazyLoadInstance.update()
    window.pjax && window.pjax.refresh($dom)
  }

  const newestCommentInit = () => {
    if (document.querySelector('#card-newest-comments .aside-list')) {
      const data = saveToLocal.get('twikoo-newest-comments')
      if (data) {
        generateHtml(JSON.parse(data))
      } else {
        getComment()
      }
    }
  }

  newestCommentInit()
  document.addEventListener('pjax:complete', newestCommentInit)
})</script><script type="text/javascript" color="238,130,238" opacity='0.9' zIndex="1" count="99" src="/js/canvas-nest.js"></script><div class="aplayer no-destroy" data-id="7983636384" data-server="netease" data-type="playlist" data-fixed="true" data-autoplay="false" data-loop="all"> </div><div id="sakana-widget" style="position:fixed;bottom:10px;right:35px;z-index:999;"></div><script>function initSakanaWidget() {new SakanaWidget().mount('#sakana-widget');}</script><script async onload="initSakanaWidget()" src="https://cdn.jsdelivr.net/npm/sakana-widget@2.3.2/lib/sakana.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/activate-power-mode.min.js"></script><script>POWERMODE.colorful = true;
POWERMODE.shake = false;
POWERMODE.mobile = false;
document.body.addEventListener('input', POWERMODE);
</script><script id="click-show-text" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/click-show-text.min.js" data-mobile="false" data-text="❤富强❤,❤民主❤,❤文明❤,❤和谐❤,❤自由❤,❤平等❤,❤公正❤,❤法治❤,❤爱国❤,❤敬业❤,❤诚信❤,❤友善❤" data-fontsize="17px" data-random="false" async="async"></script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/aplayer/dist/APlayer.min.js"></script><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/metingjs/dist/Meting.min.js"></script><!--if theme.aplayer && theme.aplayer.enable--><!--	.aplayer(data-id=theme.aplayer.id data-server=theme.aplayer.server data-type=theme.aplayer.type data-fixed=theme.aplayer.fixed data-mini=theme.aplayer.mini //data-listFolded=theme.aplayer.listFolded data-order=theme.aplayer.order data-preload=theme.aplayer.preload)--><!--	each item in theme.aplayer.css--><!--		link(rel='stylesheet', href=item)--><!--	each item in theme.aplayer.js--><!--		script(src=item)--><script src="https://cdn.jsdelivr.net/npm/pjax/pjax.min.js"></script><script>let pjaxSelectors = ["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]

var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {

  // removeEventListener scroll 
  window.tocScrollFn && window.removeEventListener('scroll', window.tocScrollFn)
  window.scrollCollect && window.removeEventListener('scroll', scrollCollect)

  typeof preloader === 'object' && preloader.initLoading()
  document.getElementById('rightside').style.cssText = "opacity: ''; transform: ''"
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')

  typeof disqusjs === 'object' && disqusjs.destroy()
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof chatBtnFn === 'function' && chatBtnFn()
  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()

  typeof preloader === 'object' && preloader.endLoading()
})

document.addEventListener('pjax:error', (e) => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><script async>window.onload=function(){var a=document.createElement('script'),b=document.getElementsByTagName('script')[0];a.type='text/javascript',a.async=!0,a.src='/sw-register.js?v='+Date.now(),b.parentNode.insertBefore(a,b)};</script></body></html>